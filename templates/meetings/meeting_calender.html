{% extends "dashboard//layout/dashboardLayout.html" %}
{% load static %}
{% block title %}Meeting Calendar{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-xl-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Meeting Calendar</h4>
                </div>
                <div class="card-body">
                    <div id="calendar" style="width: 100%; height: 700px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Meeting Details -->
    <div class="modal fade" id="meetingDetailModal" tabindex="-1" role="dialog" aria-labelledby="meetingDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="meetingDetailModalLabel">Meeting Details</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h4 id="meeting-title"></h4>
                    <p><strong>Date:</strong> <span id="meeting-date"></span></p>
                    <p><strong>Time:</strong> <span id="meeting-time"></span></p>
                    <p><strong>Description:</strong> <span id="meeting-description"></span></p>
                    <p><strong>Meeting URL:</strong> <a id="meeting-url" href="#" target="_blank">Join Meeting</a></p>
                    <p id="meeting-password-container"><strong>Password:</strong> <span id="meeting-password"></span></p>
                </div>
                <div class="modal-footer">
                    <a id="meeting-detail-link" href="#" class="btn btn-info">View Details</a>
                    <a id="meeting-edit-link" href="#" class="btn btn-warning">Edit</a>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Include FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var today = new Date();
        
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
            },
            initialDate: today,
            navLinks: true,
            selectable: true,
            selectMirror: true,
            dayMaxEvents: true,
            events: {{ event_data|safe }},
            eventTimeFormat: {
                hour: '2-digit',
                minute: '2-digit',
                meridiem: 'short'
            },
            eventDidMount: function(info) {
                // Make sure HTML content is rendered properly
                var titleEl = info.el.querySelector('.fc-event-title');
                if (titleEl) {
                    titleEl.innerHTML = info.event.title;
                }
            },
            eventClick: function(info) {
                // Prevent navigation to URL if defined in event
                info.jsEvent.preventDefault();
                
                // Get meeting details from event
                var title = info.event.title;
                var start = info.event.start;
                var end = info.event.end || start;
                var url = info.event.extendedProps.url || '#';
                var description = info.event.extendedProps.description || 'No description provided';
                
                // Update modal with meeting details
                document.getElementById('meeting-title').textContent = title;
                document.getElementById('meeting-date').textContent = moment(start).format('dddd, MMMM D, YYYY');
                document.getElementById('meeting-time').textContent = moment(start).format('h:mm A') + ' - ' + moment(end).format('h:mm A');
                document.getElementById('meeting-description').textContent = description;
                
                // Set up meeting URL
                var meetingUrlElement = document.getElementById('meeting-url');
                if (url && url !== '#') {
                    meetingUrlElement.href = url;
                    meetingUrlElement.parentElement.style.display = 'block';
                } else {
                    meetingUrlElement.parentElement.style.display = 'none';
                }
                
                // Set up detail and edit links
                document.getElementById('meeting-detail-link').href = '/meetings/' + info.event.id + '/';
                document.getElementById('meeting-edit-link').href = '/meetings/' + info.event.id + '/update/';
                
                // Show the modal
                $('#meetingDetailModal').modal('show');
            }
        });
        
        calendar.render();
    });
</script>
{% endblock %}